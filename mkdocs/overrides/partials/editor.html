{#
  Live Markdown Editor (text-forge).

  Provides an "Edit" button on content pages that opens a split-pane editor
  with live preview using Pyodide + PyMdown Extensions.

  Config (mkdocs.yml -> extra:):
    editor:
      enabled: true   # Show editor button on content pages
#}

{% set editor_cfg = config.extra.get("editor", {}) %}
{% set editor_enabled = editor_cfg.get("enabled", false) %}

{% if editor_enabled and page and page.content %}
<!-- Live Editor Panel -->
<div id="md-editor" class="md-editor" hidden>
  <div class="md-editor__toolbar">
    <span class="md-editor__title" data-i18n="editor_title">Редактор Markdown</span>
    <div class="md-editor__actions">
      <button id="md-editor-download" class="md-editor__btn" data-i18n-title="editor_download" title="Скачать .md">
        {% include ".icons/material/download.svg" %}
      </button>
      <button id="md-editor-close" class="md-editor__btn" title="Закрыть">
        {% include ".icons/material/close.svg" %}
      </button>
    </div>
  </div>
  <div class="md-editor__content">
    <div class="md-editor__pane md-editor__pane--source">
      <textarea id="md-editor-source" spellcheck="false" data-i18n-placeholder="editor_loading" placeholder="Загрузка редактора..."></textarea>
    </div>
    <div class="md-editor__pane md-editor__pane--preview">
      <div id="md-editor-preview" class="md-typeset"></div>
    </div>
  </div>
  <div class="md-editor__status">
    <span id="md-editor-status" data-i18n="editor_status_ready">Готов</span>
  </div>
</div>

<!-- Editor Toggle Button (fab style, bottom-right) -->
<button id="md-editor-toggle" class="md-editor-fab" data-i18n-title="editor_title" title="Редактировать">
  {% include ".icons/material/pencil.svg" %}
</button>

<!-- Pass page metadata and source content to JS -->
<script>
  window.__MD_EDITOR__ = {
    sourceUrl: "{{ (config.repo_url ~ '/' ~ config.edit_uri ~ page.file.src_path)|e }}".replace('/blob/', '/raw/'),
    fileName: "{{ page.file.name|e }}",
    // Embed source for local dev (mkdocs serve)
    sourceContent: {{ page.markdown | tojson }}
  };
</script>
{% endif %}
